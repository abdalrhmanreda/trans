<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙˆØ§Ù„Ù…Ø¯Ù† - Ù‚Ø±ÙŠØªÙ†Ø§</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .container {
            background: white;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 2rem;
            font-size: 1.8rem;
        }

        .info-box {
            background: #f0f4ff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
            border-right: 4px solid #667eea;
        }

        .info-box p {
            line-height: 1.8;
            color: #334155;
        }

        .progress-container {
            margin: 2rem 0;
            display: none;
        }

        .progress-bar {
            height: 10px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            color: #64748b;
            font-size: 0.9rem;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 0.75rem;
            font-family: 'Cairo', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #10b981;
            color: white;
            margin-top: 1rem;
        }

        .log-container {
            margin-top: 2rem;
            max-height: 300px;
            overflow-y: auto;
            background: #f8fafc;
            padding: 1rem;
            border-radius: 0.75rem;
            display: none;
        }

        .log-item {
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-success {
            color: #10b981;
        }

        .log-error {
            color: #ef4444;
        }

        .log-info {
            color: #3b82f6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.9rem;
            margin-top: 0.5rem;
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <!-- Login Screen -->
    <div class="container" id="loginContainer">
        <h1>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>

        <div class="info-box">
            <p><strong>ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹</strong></p>
            <p style="margin-top: 1rem;">ÙŠØªØ·Ù„Ø¨ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</p>
        </div>

        <div style="margin: 2rem 0;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
            <input type="email" id="loginEmail" placeholder="admin@example.com"
                style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; font-family: 'Cairo', sans-serif; margin-bottom: 1rem;">

            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
            <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; font-family: 'Cairo', sans-serif;">
        </div>

        <button class="btn btn-primary" onclick="loginAdmin()" style="width: 100%;">
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        </button>

        <div id="loginError"
            style="display: none; margin-top: 1rem; padding: 1rem; background: #fee2e2; border-radius: 0.5rem; color: #991b1b;">
        </div>
    </div>

    <!-- Import Screen (hidden initially) -->
    <div class="container" id="importContainer" style="display: none;">
        <h1>ğŸ›ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙˆØ§Ù„Ù…Ø¯Ù†</h1>

        <div class="info-box">
            <p><strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> Ø³ÙŠØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙˆØ§Ù„Ù…Ø¯Ù† Ù…Ù† Ù…Ù„Ù <code>cities.json</code> ÙˆØ¥Ø¶Ø§ÙØªÙ‡Ø§
                ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>
            <p style="margin-top: 1rem;">âœ… Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª: Ø³ÙŠØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯Ù‡Ø§ Ø¬Ù…ÙŠØ¹Ø§Ù‹</p>
            <p>âœ… Ø§Ù„Ù…Ø¯Ù†: Ø³ÙŠØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯Ù‡Ø§ ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ù…Ø­Ø§ÙØ¸Ø§ØªÙ‡Ø§</p>
            <p>âš ï¸ Ø§Ù„Ù‚Ø±Ù‰: ØªØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
        </div>

        <div style="background: #d1fae5; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
            <p style="color: #065f46;">âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­: <strong id="userEmail"></strong></p>
        </div>

        <button id="importBtn" class="btn btn-primary" onclick="startImport()">
            Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
        </button>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯...</div>
        </div>

        <div class="log-container" id="logContainer"></div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="govCount">0</div>
                <div class="stat-label">Ù…Ø­Ø§ÙØ¸Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="cityCount">0</div>
                <div class="stat-label">Ù…Ø¯ÙŠÙ†Ø©</div>
            </div>
        </div>

        <button id="dashboardBtn" class="btn btn-success" onclick="goToDashboard()" style="display: none;">
            Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </button>
    </div>

    <script type="module">
        import { FirebaseService, auth } from '../js/firebase-service.js';
        import { signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Login function
        window.loginAdmin = async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (!email || !password) {
                errorDiv.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
                errorDiv.style.display = 'block';
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);

                // Login successful
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('importContainer').style.display = 'block';
                document.getElementById('userEmail').textContent = email;

            } catch (error) {
                console.error('Login error:', error);
                errorDiv.textContent = 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + (error.message || 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                errorDiv.style.display = 'block';
            }
        };

        // Auto-check if already logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('importContainer').style.display = 'block';
                document.getElementById('userEmail').textContent = user.email;
            }
        });

        window.goToDashboard = () => {
            window.location.href = 'dashboard.html';
        };

        window.startImport = async () => {
            const btn = document.getElementById('importBtn');
            const progressContainer = document.getElementById('progressContainer');
            const logContainer = document.getElementById('logContainer');
            const stats = document.getElementById('stats');
            const dashboardBtn = document.getElementById('dashboardBtn');

            btn.disabled = true;
            progressContainer.style.display = 'block';
            logContainer.style.display = 'block';
            logContainer.innerHTML = '';

            function log(message, type = 'info') {
                const logItem = document.createElement('div');
                logItem.className = `log-item log-${type}`;
                logItem.textContent = message;
                logContainer.appendChild(logItem);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            function updateProgress(percent, text) {
                document.getElementById('progressFill').style.width = percent + '%';
                document.getElementById('progressText').textContent = text;
            }

            try {
                // Load JSON file
                log('â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† cities.json...', 'info');
                const response = await fetch('../data/cities.json');
                const data = await response.json();

                if (!data || data.length === 0) {
                    throw new Error('Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ ØºÙŠØ± ØµØ§Ù„Ø­');
                }

                const country = data[0]; // Ù…ØµØ±
                const states = country.state || [];

                log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${states.length} Ù…Ø­Ø§ÙØ¸Ø©`, 'success');
                updateProgress(10, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

                let govCount = 0;
                let cityCount = 0;
                const totalSteps = states.length;

                // Import governorates and cities
                for (let i = 0; i < states.length; i++) {
                    const state = states[i];
                    const progress = 10 + ((i + 1) / totalSteps * 80);

                    log(`ğŸ“ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ©: ${state.name}`, 'info');

                    // Add governorate
                    const govResult = await FirebaseService.addGovernorate({
                        name: state.name,
                        icon: country.emoji || 'ğŸ›ï¸',
                        originalId: state.id
                    });

                    if (govResult.success) {
                        govCount++;
                        log(`  âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${state.name}`, 'success');

                        // Add cities for this governorate
                        const cities = state.city || [];
                        for (const city of cities) {
                            const cityResult = await FirebaseService.addCity({
                                name: city.name,
                                governorateId: govResult.id,
                                originalId: city.id
                            });

                            if (cityResult.success) {
                                cityCount++;
                            } else {
                                log(`  âš ï¸ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${city.name}`, 'error');
                            }
                        }
                        log(`  âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${cities.length} Ù…Ø¯ÙŠÙ†Ø© Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø©`, 'success');
                    } else {
                        log(`  âŒ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${state.name} - ${govResult.error}`, 'error');
                    }

                    updateProgress(progress, `ØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© ${i + 1} Ù…Ù† ${totalSteps} Ù…Ø­Ø§ÙØ¸Ø©`);
                }

                updateProgress(100, 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯! ğŸ‰');
                log('ğŸ‰ ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                log(`ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${govCount} Ù…Ø­Ø§ÙØ¸Ø© Ùˆ ${cityCount} Ù…Ø¯ÙŠÙ†Ø©`, 'success');

                // Update stats
                document.getElementById('govCount').textContent = govCount;
                document.getElementById('cityCount').textContent = cityCount;
                stats.style.display = 'grid';
                dashboardBtn.style.display = 'block';

            } catch (error) {
                log(`âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}`, 'error');
                console.error('Import error:', error);
                btn.disabled = false;
                updateProgress(0, 'ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
            }
        };
    </script>
</body>

</html>